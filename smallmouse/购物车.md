##购物车之进阶版 
```js
 if (this.$store.state.loginState === 'ok') {
        let result = { pic, name, sale, proid, flag, num }
        if (!localStorage.getItem('cars')) { //1如果触发时没有本地数据 就将新创建的对象obj和新创建的lis购物车作为新的放进本地
          this.lis.push(result)
          this.obj[this.userinfo] = this.lis
          localStorage.setItem('cars', JSON.stringify(this.obj))
        } else { // 2否则就是有本地  如果有本地 下一步
          let dic = JSON.parse(localStorage.getItem('cars'))
          if (dic[this.userinfo] !== undefined) { // 2.1如果本地obj[此时的用户] ！==undefined 说明这个用户里的购物车有数据
            this.lis = dic[this.userinfo] //有数据就将老数据赋值给 购物车lis
            let flag = false
            this.lis.map(item => { // 循环老数据，看老数据里的名字与 新添加的 result名字是否有重复
              if (item.name === result.name) {  //2.1.1如果有重复就将老数据的num+1
                item.num += 1
                flag = true //2.1.2并且给flag赋值true 让外面的购物车不要添加进去
              }
            })
            if (!flag) { // 2.1.3如果flag等于flase就说明老数据没有此商品，正常添加
              this.lis.push(result)
              flag = false
            }
            dic[this.userinfo] = this.lis // 最后一步 重新赋值给dic对象
            localStorage.setItem('cars', JSON.stringify(dic)) //解析
          } else {
            this.lis.push(result) //2.2如果老数据里没有这个账户。就说明他没有购物车数据，此时就要重新给他添加数据了
            dic[this.userinfo] = this.lis
            // dic[this.userinfo] = this.lis
            localStorage.setItem('cars', JSON.stringify(dic))
          }
        }
      } else {
        this.$router.push('/login')
      }
    },
```

```js
addBuycart (state, data) {
      let data1 = data.result
      if (data1[state.userInfo] !== undefined) {
        let newArr = []
        let newsArr = []
        for (let i = 0; i < data1[state.userInfo].length; i++) { // 求相同数量
          newsArr.push(data1[state.userInfo][i].proid)
        }
        let bb = newsArr.reduce(function (prev, next) {
          prev[next] = (prev[next] + 1) || 1
          return prev
        }, {})
        for (let i = 0; i < data1[state.userInfo].length; i++) { // 去重
          let flag = true
          for (let a = 0; a < newArr.length; a++) {
            if (data1[state.userInfo][i].proid == newArr[a].proid) {
              flag = false
            }
          }
          if (flag) {
            newArr.push(data1[state.userInfo][i])
          }
        }
        for (let p = 0; p < newArr.length; p++) { // 合并
          for (let i in bb) {
            if (newArr[p].proid == Number(i)) {
              newArr[p].num = bb[i] // 先循环去重, 2看key出现几次，3，一一通过循环对应（循环去重后的数组，里面）
              newArr[p].idd = 1
            }
          }
        }
        state.buyBaby = newArr
      }
    }
  },
  ``